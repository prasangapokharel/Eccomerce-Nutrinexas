=== Complete Order, Earning, Withdrawal & Cancellation Flow Test ===
Testing 20 Real-World Scenarios
Start Time: 2025-11-23 09:24:02

=== Setup ===
✓ Referrer: Jaya Pokharel (ID: 5)
✓ Initial Balance: Rs 250.00
✓ Product 1: 15% commission, Rs 1000
✓ Product 2: Default 5% commission, Rs 500

=== Test Scenarios ===

Scenario 1: Order created, pending earning created
✓ Pending earning created: Rs 150.00
✓ Balance unchanged: Rs 0

Scenario 2: Order delivered, earning paid
✓ Earning paid: Rs 150.00
✓ Balance updated: Rs 150

Scenario 3: Order cancelled before payment (pending earning)
✓ Earning cancelled (pending)
✓ Balance unchanged: Rs 150

Scenario 4: Order cancelled after payment (paid earning)
✓ Earning cancelled (paid)
✓ Balance deducted: Rs 300 -> Rs 150

Scenario 5: Withdrawal from available balance
✓ Withdrawal created: Rs 100
✓ Balance deducted: Rs 300 -> Rs 200

Scenario 6: Withdrawal then order cancellation
✓ Withdrawal: Rs 50
✓ Cancellation deducted: Rs 150
✓ Final balance: Rs 150

Scenario 7: Multiple orders, multiple earnings
✓ 3 orders processed
✓ New earnings: Rs 450
✓ Balance: Rs 150 -> Rs 600

Scenario 8: Product with default commission
✓ Default commission used: 5%
✓ Commission: Rs 25.00

Scenario 9: Order with multiple items, different commissions
✓ Multi-item order processed
✓ Total commission: Rs 175.00

Scenario 10: Insufficient balance withdrawal attempt
✓ Insufficient balance error caught
✓ Balance unchanged: Rs 600

Scenario 11: Cancel already cancelled order
✓ Already cancelled order handled correctly

Scenario 12: Process already paid earning
✓ Already paid earning handled correctly

Scenario 13: Multiple withdrawals
✓ 2 withdrawals processed
✓ Balance: Rs 900 -> Rs 800

Scenario 14: Order quantity > 1
✓ Quantity 3 processed correctly
✓ Commission: Rs 450.00

Scenario 15: Cancel order without earning
✓ No earning found, handled correctly

Scenario 16: Create duplicate pending earning
✓ Duplicate earning prevented

Scenario 17: Withdrawal with exact balance
✓ Exact balance withdrawal successful
✓ Final balance: Rs 0

Scenario 18: Mixed orders (some paid, some cancelled)
✓ 2 paid orders: Rs 300
✓ 2 cancelled orders: Rs 300 (not paid)
✓ Final balance: Rs 300

Scenario 19: Cancel paid order, then withdrawal
✓ Paid order cancelled
✓ Withdrawal after cancellation handled

Scenario 20: Complex flow - multiple orders, withdrawals, cancellations
✓ 5 orders created
✓ 3 paid, 1 cancelled (paid), 2 cancelled (pending)
✓ 1 withdrawal: Rs 200
✓ Final balance: Rs 100

============================================================
TEST SUMMARY
============================================================
End Time: 2025-11-23 09:24:07
Total Scenarios: 20
Passed: 20
Failed: 0
Pass Rate: 100.0%
============================================================

SCENARIO DETAILS
------------------------------------------------------------
✓ PASS  1. Order created, pending earning
✓ PASS  2. Order delivered, earning paid
✓ PASS  3. Order cancelled before payment
✓ PASS  4. Order cancelled after payment
✓ PASS  5. Withdrawal from available balance
✓ PASS  6. Withdrawal then order cancellation
✓ PASS  7. Multiple orders, multiple earnings
✓ PASS  8. Product with default commission
✓ PASS  9. Order with multiple items
✓ PASS 10. Insufficient balance withdrawal
✓ PASS 11. Cancel already cancelled order
✓ PASS 12. Process already paid earning
✓ PASS 13. Multiple withdrawals
✓ PASS 14. Order quantity > 1
✓ PASS 15. Cancel order without earning
✓ PASS 16. Create duplicate pending earning
✓ PASS 17. Withdrawal with exact balance
✓ PASS 18. Mixed orders
✓ PASS 19. Cancel paid order, then withdrawal
✓ PASS 20. Complex flow
------------------------------------------------------------

✓ SUCCESS: All 20 scenarios passed! System is working correctly.
